#import "../fragments/index.graphql"

query CurrentUser {
  current_user {
    ...user
    memberships {
      ...membership
    }
  }
}

query Countries {
  country_codes
}

query ServicesAgreement {
  markdowns(filter: { name: "Services Agreement", agency_id: null }) {
    ...markdown
  }
}

query AgencyStripeAccountUpdateUrl($agency_id: ID!, $livemode: Boolean!) {
  agency(id: $agency_id) {
    id
    stripe_account(livemode: $livemode) {
      id
      account_update_url {
        url
      }
    }
  }
}

query AgencyStripeAccountBalance($agency_id: ID!, $livemode: Boolean!) {
  agency(id: $agency_id) {
    id
    stripe_account(livemode: $livemode) {
      id
      balance {
        available {
          amount
          currency
          source_types {
            card
            bank_account
          }
        }
        pending {
          amount
          currency
          source_types {
            card
            bank_account
          }
        }
        connect_reserved {
          amount
          currency
          source_types {
            card
            bank_account
          }
        }
      }
    }
  }
}

query AgencyStripeAccountBalanceTransactions(
  $agency_id: ID!
  $livemode: Boolean!
  $created: DateTime
  $starting_after_id: String
  $ending_before_id: String
  $limit: Int
) {
  agency(id: $agency_id) {
    id
    stripe_account(livemode: $livemode) {
      id
      balance_transactions(
        created: $created
        starting_after_id: $starting_after_id
        ending_before_id: $ending_before_id
        limit: $limit
      ) {
        ...balance_transaction
      }
    }
  }
}

query AgencyStripeAccountPaymentIntents(
  $agency_id: ID!
  $livemode: Boolean!
  $created: DateTime
  $starting_after_id: String
  $ending_before_id: String
  $limit: Int
) {
  agency(id: $agency_id) {
    id
    stripe_account(livemode: $livemode) {
      id
      payment_intents(
        created: $created
        starting_after_id: $starting_after_id
        ending_before_id: $ending_before_id
        limit: $limit
      ) {
        ...payment_intent
      }
    }
  }
}

query AgencyStripeAccountCustomers(
  $agency_id: ID!
  $livemode: Boolean!
  $created: DateTime
  $starting_after_id: String
  $ending_before_id: String
  $limit: Int
) {
  agency(id: $agency_id) {
    id
    stripe_account(livemode: $livemode) {
      id
      customers(
        created: $created
        starting_after_id: $starting_after_id
        ending_before_id: $ending_before_id
        limit: $limit
      ) {
        ...customer
      }
    }
  }
}

query AgencySubscriptionPlan(
  $agency_id: ID!
) {
  agency(id: $agency_id) {
    id
    subscription_plan {
      ...subscription_plan
    }
  }
}

query Agency($agency_id: ID!) {
  agency(id: $agency_id) {
    ...agency
  }
}

query Agencies($filter: AgencyFilter!) {
  agencies(filter: $filter) {
    ...agency
  }
}

query CurrentUserAgencies {
  current_user {
    id
    memberships {
      id
      access
      subdomain {
        id
        name
        agency {
          ...agency
          stripe_account(livemode: true) {
            ...stripe_account
          }
        }
        memberships {
          ...membership
        }
      }
      user {
        id
      }
    }
  }
}

query SubdomainPublic($subdomain_name: String!) {
  subdomains(filter: { name: $subdomain_name }) {
    id
    name
    agency {
      id
      name
      theme {
        ...theme
      }
    }
  }
}

query AgencyProducts($agency_id: ID!) {
  agency(id: $agency_id) {
    id
    products {
      ...product
    }
  }
}

query Product($product_id: ID!) {
  product(id: $product_id) {
    ...product
  }
}

query Products($filter: ProductFilter!) {
  products(filter: $filter) {
    ...product
  }
}


query ProductAndAgencyFromUrlParts($subdomain_name: String!, $product_url_name: String!) {
  subdomains(filter: { name: $subdomain_name }) {
    id
    name
    agency {
      id
      products(filter: { url_name: $product_url_name }) {
        ...product
        agency {
          ...agency
        }
      }
    }
  }
}

query SubdomainAgency($subdomain_name: String!) {
  subdomains(filter: { name: $subdomain_name }) {
    id
    name
    agency {
      ...agency
      products {
        ...product
      }
    }
  }
}

query SubdomainAgencyStripeAccountUpdateUrl($subdomain_name: String!, $livemode: Boolean!) {
  subdomains(filter: { name: $subdomain_name }) {
    id
    name
    agency {
      id
      stripe_account(livemode: $livemode) {
        account_update_url {
          url
        }
      }
    }
  }
}

query AgencyThankYouPageSetting($agency_id: ID!) {
  agency(id: $agency_id) {
    id
    settings {
      id
      thank_you_page_setting {
        id
        url
      }
    }
  }
}

query ProductThankYouPageSetting($product_id: ID!) {
  product(id: $product_id) {
    id
    settings {
      id
      thank_you_page_setting {
        id
        url
      }
    }
  }
}


query AgencyPages($agency_id: ID!, $page_definition_id: ID) {
  pages(filter: { agency_id: $agency_id, page_definition_id: $page_definition_id }) {
    ...page
  }
}

query ProductPages($product_id: ID!, $page_definition_id: ID) {
  pages(filter: { product_id: $product_id, page_definition_id: $page_definition_id }) {
    ...page
  }
}

query Page($page_id: ID!) {
  page(id: $page_id) {
    ...page
  }
}

query PageByUrl($url: String!) {
  page_by_url(url: $url) {
    ...page
  }
}

query PageBlock($page_block_id: ID!) {
  page_block(id: $page_block_id) {
    ...page_block
  }
}

query PageDefinition($page_definition_id: ID!) {
  page_definition(id: $page_definition_id) {
    ...page_definition
  }
}

query PageBlockDefinition($page_block_definition_id: ID!) {
  page_block_definition(id: $page_block_definition_id) {
    ...page_block_definition
  }
}

query PageDefinitionsByName($name: String!) {
  page_definitions(filter: { name: $name }) {
    ...page_definition
  }
}

query PageDefinitionByUrlPath($url_path: String!) {
  page_definition_by_url_path(url_path: $url_path) {
    ...page_definition
  }
}

query PageBlockDefinitionsByName($name: String!) {
  page_block_definitions(filter: { name: $name }) {
    ...page_block_definition
  }
}

query CalculateTransactionFee($subscription_plan_id: ID!, $amount: Int!, $currency: String!) {
  subscription_plan(id: $subscription_plan_id) {
    id
    calculate_fee(amount: $amount, currency: $currency)
  }
}
